"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[40587,89989],{13249:function(t,e,n){n.d(e,{B:function(){return d},q:function(){return c}});var a=n(30566),i=n(80717),o=n(2232),r=n(93392),s=n(52781);let l=null;async function c(t){let{url:e,editor:n,instance:c=null,pattern:u=null,extra_class:p=null}=t;const m=l,v=l=n.state.doc.nodeAt(n.state.selection.from);if(null===c||v===m&&c?.tippy.popperInstance||(await d({instance:c,pattern_name:u.name}),c=null),c&&c?.tippy.popperInstance)c.get_content(e);else{u&&(a.A.patterns[u.name]=u);const t=n.options.element;c=new r.Ay(t,{source:"ajax",url:e,trigger:"none",class:p,"position-list":["tl"]}),await o.A.await_pattern_init(c);const l=(0,s.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);c.tippy?.setProps({getReferenceClientRect:()=>l}),o.A.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async t=>{[t.target,...i.A.get_parents(t.target)].includes(c?.tippy.popper)||(await d({instance:c,pattern_name:u.name}),c=null)})),o.A.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async t=>{"Escape"===t.key&&(await d({instance:c,pattern_name:u.name}),c=null)})),c.show()}return c}async function d(t){let{instance:e,pattern_name:n}=t;return e&&(await e.hide(),e.destroy(),e=null),n&&delete a.A.patterns[n],o.A.remove_event_listener(document,"tiptap--context_menu_close--click"),o.A.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},40587:function(t,e,n){n.r(e),n.d(e,{factory:function(){return y}});var a=n(52781),i=n(42845),o=n(1575);function r(t){var e;const{char:n,allowSpaces:i,allowToIncludeChar:o,allowedPrefixes:r,startOfLine:s,$position:l}=t,c=i&&!o,d=(0,a.escapeForRegEx)(n),u=new RegExp(`\\s${d}$`),p=s?"^":"",m=o?"":d,v=c?new RegExp(`${p}${d}.*?(?=\\s${m}|$)`,"gm"):new RegExp(`${p}(?:^)?${d}[^\\s${m}]*`,"gm"),g=(null===(e=l.nodeBefore)||void 0===e?void 0:e.isText)&&l.nodeBefore.text;if(!g)return null;const h=l.pos-g.length,f=Array.from(g.matchAll(v)).pop();if(!f||void 0===f.input||void 0===f.index)return null;const y=f.input.slice(Math.max(0,f.index-1),f.index),w=new RegExp(`^[${null==r?void 0:r.join("")}\0]?$`).test(y);if(null!==r&&!w)return null;const _=h+f.index;let x=_+f[0].length;return c&&u.test(g.slice(x-1,x+1))&&(f[0]+=" ",x+=1),_<l.pos&&x>=l.pos?{range:{from:_,to:x},query:f[0].slice(n.length),text:f[0]}:null}const s=new i.hs("suggestion");function l({pluginKey:t=s,editor:e,char:n="@",allowSpaces:a=!1,allowToIncludeChar:l=!1,allowedPrefixes:c=[" "],startOfLine:d=!1,decorationTag:u="span",decorationClass:p="suggestion",command:m=()=>null,items:v=()=>[],render:g=()=>({}),allow:h=()=>!0,findSuggestionMatch:f=r}){let y;const w=null==g?void 0:g(),_=new i.k_({key:t,view(){return{update:async(t,n)=>{var a,i,o,r,s,l,c;const d=null===(a=this.key)||void 0===a?void 0:a.getState(n),u=null===(i=this.key)||void 0===i?void 0:i.getState(t.state),p=d.active&&u.active&&d.range.from!==u.range.from,g=!d.active&&u.active,h=d.active&&!u.active,f=!g&&!h&&d.query!==u.query,_=g||p&&f,x=f||p,b=h||p&&f;if(!_&&!x&&!b)return;const A=b&&!_?d:u,$=t.dom.querySelector(`[data-decoration-id="${A.decorationId}"]`);y={editor:e,range:A.range,query:A.query,text:A.text,items:[],command:t=>m({editor:e,range:A.range,props:t}),decorationNode:$,clientRect:$?()=>{var n;const{decorationId:a}=null===(n=this.key)||void 0===n?void 0:n.getState(e.state),i=t.dom.querySelector(`[data-decoration-id="${a}"]`);return(null==i?void 0:i.getBoundingClientRect())||null}:null},_&&(null===(o=null==w?void 0:w.onBeforeStart)||void 0===o||o.call(w,y)),x&&(null===(r=null==w?void 0:w.onBeforeUpdate)||void 0===r||r.call(w,y)),(x||_)&&(y.items=await v({editor:e,query:A.query})),b&&(null===(s=null==w?void 0:w.onExit)||void 0===s||s.call(w,y)),x&&(null===(l=null==w?void 0:w.onUpdate)||void 0===l||l.call(w,y)),_&&(null===(c=null==w?void 0:w.onStart)||void 0===c||c.call(w,y))},destroy:()=>{var t;y&&(null===(t=null==w?void 0:w.onExit)||void 0===t||t.call(w,y))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(t,i,o,r){const{isEditable:s}=e,{composing:u}=e.view,{selection:p}=t,{empty:m,from:v}=p,g={...i};if(g.composing=u,s&&(m||e.view.composing)){!(v<i.range.from||v>i.range.to)||u||i.composing||(g.active=!1);const t=f({char:n,allowSpaces:a,allowToIncludeChar:l,allowedPrefixes:c,startOfLine:d,$position:p.$from}),o=`id_${Math.floor(4294967295*Math.random())}`;t&&h({editor:e,state:r,range:t.range,isActive:i.active})?(g.active=!0,g.decorationId=i.decorationId?i.decorationId:o,g.range=t.range,g.query=t.query,g.text=t.text):g.active=!1}else g.active=!1;return g.active||(g.decorationId=null,g.range={from:0,to:0},g.query=null,g.text=null),g}},props:{handleKeyDown(t,e){var n;const{active:a,range:i}=_.getState(t.state);return a&&(null===(n=null==w?void 0:w.onKeyDown)||void 0===n?void 0:n.call(w,{view:t,event:e,range:i}))||!1},decorations(t){const{active:e,range:n,decorationId:a}=_.getState(t);return e?o.zF.create(t.doc,[o.NZ.inline(n.from,n.to,{nodeName:u,class:p,"data-decoration-id":a})]):null}}});return _}var c=n(13249),d=n(89989),u=n(13744),p=n(80717),m=n(2232),v=n(49264),g=n(83825);let h;function f(t,e){class n extends u.m{static name="tiptap-suggestion";static trigger=".tiptap-items";init(){(0,d.focus_handler)(this.el),this.active=this.items[0],m.A.add_event_listener(this.el,"keydown","tiptap-suggestion-keydown",(t=>{t.preventDefault(),t.stopPropagation();const e=this.items,n=this.active;if("ArrowDown"===t.code)if(n){let t=n?e.indexOf(n)+1:0;t>=e.length&&(t=0),this.active=e[t]}else this.active=e[0];else if("ArrowUp"===t.code)if(n){let t=n?e.indexOf(n)-1:0;t<0&&(t=e.length-1),this.active=e[t]}else this.active=e[0];else if("Enter"===t.code){const t=n?.dataset?.tiptapValue;if(!t)return;const e=n.querySelector("a");this.command(e,t)}})),m.A.add_event_listener(this.el,"click","tiptap-suggestion-click",(t=>{const e=t.target.closest("a"),n=p.A.acquire_attribute(e,"data-tiptap-value");n&&(t.preventDefault(),this.command(e,n))}))}command(t,n){const a=Object.fromEntries([...t.attributes].map((t=>[t.name,t.value])));e.command({"data-title":n,...a})}get active(){return this.el.querySelector(".tiptap-item.active")}set active(t){t&&(this.active?.classList.remove("active"),t.classList.add("active"))}get items(){return[...this.el.querySelectorAll(".tiptap-item")]}}return n}const y=t=>{let{app:e,name:n,char:o,plural:r}=t;return a.Node.create({name:n,content:"inline*",group:"inline",inline:!0,selectable:!1,atom:!0,isolating:!0,addOptions(){return{HTMLAttributes:{},url:null,renderLabel(t){let{options:e,node:n}=t;const a=(n.attrs["data-title"]||n.content?.content?.[0]?.text||"").replace(new RegExp(`^${e.suggestion.char}`),"");return`${e.suggestion.char}${a}`},suggestion:{char:o,pluginKey:new i.hs(n)}}},addAttributes(){const t={class:{},contenteditable:{},href:{},target:{},title:{},"data-id":{},"data-title":{},"data-pat-inject":{},"data-pat-forward":{},"data-pat-modal":{},"data-pat-switch":{},"data-pat-toggle":{},"data-pat-tooltip":{}};t[`data-${this.name}`]={default:""};for(const e of g.Ay.accessibility_attributes)t[e]={};return t},parseHTML(){return[{tag:`a[data-${this.name}]`}]},renderHTML(t){let{node:e,HTMLAttributes:n}=t;return["a",(0,a.mergeAttributes)(this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:e})]},renderText(t){let{node:e}=t;return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Enter:()=>!!h&&(h.tippy?.popper?.querySelector(".tiptap-items")?.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter"})),!0),Backspace:t=>{let{editor:e}=t;return e.commands.command((t=>{let{tr:e,state:n}=t,a=!1;const{selection:i}=n,{empty:o,anchor:r}=i;return!!o&&(n.doc.nodesBetween(r-1,r,((t,n)=>{if(t.type.name===this.name)return a=!0,e.insertText(this.options.suggestion.char||"",n,n+t.nodeSize),!1})),a)}))}}},addProseMirrorPlugins(){var t=this;return this.options.suggestion.command=t=>{let{editor:e,range:n,props:a}=t;n.to=e.state.selection.$head.pos,e.chain().focus().insertContentAt(n,[{type:this.name,attrs:a},{type:"text",text:" "}]).run()},this.options.suggestion.render=()=>{let e;const n=async()=>{this.editor.off("selectionUpdate",e),await(0,c.B)({instance:h,pattern_name:"tiptap-suggestion"}),h=null};return{onStart:async n=>{const a=async function(){let{transaction:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{transaction:null},a=t.options.url,i=n.range.from+1,o=e?e.curSelection.$head.pos:n.range.to;const s=t.editor.state.doc.textBetween(i,o,"");a=s?a+s:a;return await(0,c.q)({url:a,editor:t.editor,instance:h,pattern:f(0,n),extra_class:`tiptap-${r||t.name}`})};e=v.A.debounce((async t=>{h=await a(t)}),200),h=await a(),this.editor.on("selectionUpdate",e)},onKeyDown:t=>{if(h&&("ArrowDown"===t.event.key||"ArrowUp"===t.event.key||"Enter"===t.event.key)){t.event.preventDefault(),t.event.stopPropagation();const e=document.querySelector(".tiptap-items");if(!e)return;e.dispatchEvent(new KeyboardEvent("keydown",{code:t.event.key}))}},onExit:()=>{n()}}},this.options.suggestion.allow=t=>{let{state:e,range:n}=t;const a=e.doc.resolve(n.from),i=e.schema.nodes[this.name];return!!a.parent.type.contentMatch.matchType(i)},[l({editor:this.editor,...this.options.suggestion})]}})}},83825:function(t,e,n){e.Ay={add_search_params:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new URL(t,window.location.href);return`${n.origin}${n.pathname}?${new URLSearchParams([...Array.from(n.searchParams.entries()),...Object.entries(e)]).toString()}`},accessibility_attributes:["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-controls","aria-describedby","aria-disabled","aria-dropeffect","aria-expanded","aria-flowto","aria-grabbed","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","role"],is_url:t=>/(^\.?\.?\/|^[^\.]+:)/.test(t),is_mail:t=>/[^@\s]+@[^@\s]+\.[^@\s]+/.test(t)}},89989:function(t,e,n){n.r(e),n.d(e,{TARGETS:function(){return o},focus_handler:function(){return r}});var a=n(2232),i=n(49264);const o=[];function r(t){t.setAttribute("tabindex","-1"),a.A.add_event_listener(t,"focus","tiptap-focusin",(async()=>{i.A.timeout(1),o.map((t=>t?.classList.add("tiptap-focus")))}),!0),a.A.add_event_listener(t,"blur","tiptap-focusout",(()=>{o.map((t=>t?.classList.remove("tiptap-focus")))}),!0)}}}]);
//# sourceMappingURL=40587.bfa46968c344c339c65c.min.js.map